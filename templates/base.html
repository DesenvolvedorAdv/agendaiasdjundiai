<!DOCTYPE html>
<html lang="pt-br">
{% load static %}
<head>
    <title>IASD Jundiai</title>
    <!-- <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'> -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.css" />
    <style>
        .espaco-superior {
            margin-top: 5rem; /* Ajuste conforme necessário */
        }

    </style>  
</head>
<body>
{% include 'navbar.html' %}
{% block content %}
{% endblock content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<div class="container" >
    <div class="row">
    {% block content2 %}{% endblock %}
 </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>    
<script src="{% static 'js/index.global.min.js' %}"></script>
<script src="{% static 'js/bootstrap5/index.global.min.js' %}"></script>
<script src="{% static 'js/core/locales-all.global.min.js' %}"></script>
<!-- <script src='../static/js/index.global.min.js'></script>
<script src='../static/js/bootstrap5/index.global.min.js'></script>
<script src='../static/js/core/locales-all.global.min.js'></script> -->
<!-- <script src="../static/js/custom.js"></script> -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');
  
  var calendar = new FullCalendar.Calendar(calendarEl, {
      locale: 'pt-br',
      timeZone: 'local',
      themeSystem: 'bootstrap5',
      headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'multiMonthYear,dayGridMonth,timeGridWeek,timeGridDay'
      },
    //   initialDate: '2024-01-12',
      navLinks: true, // permite navegar clicando nos dias/semanas
      selectable: true,
      selectMirror: true,
      events: '/all_events', // URL para buscar eventos
      editable: true,
      select: function(info) {
          var title = prompt("Nome do Evento:");
          if (title) {
              var eventData = {
                  title: title,
                  start: info.startStr,
                  end: info.endStr,
              };
              // Chama a função para adicionar evento aqui
              addEvent(eventData);
          }
          calendar.unselect();
      },
      eventClick: function(info) {
          // Implemente a lógica de clique em evento aqui, se necessário
      },
      // Adicione outros manipuladores de eventos conforme necessário
  });

  calendar.render();

  function addEvent(eventData) {
      fetch('/add_event', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': getCsrfToken(), // Função para obter o token CSRF
          },
          body: JSON.stringify(eventData)
      })
      .then(response => response.json())
      .then(data => {
          if(data.status === "success") {
              calendar.refetchEvents();
              alert("Evento adicionado com sucesso");
          }
      })
      .catch(error => {
          console.error('Erro:', error);
          alert("Erro ao adicionar evento");
      });
  }

  function getCsrfToken() {
      // Retorna o valor do cookie CSRFToken do Django
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.startsWith('csrftoken=')) {
              return cookie.substring('csrftoken='.length, cookie.length);
          }
      }
    return '';
  }
  
});
</script>

</body>
</html>